{% extends 'base.html' %} {% block content %}
<div class="px-5 py-1">
  <h1 class="text-2xl font-bold mb-4">CVD Predict</h1>
</div>

<!-- CSS tambahan untuk tombol -->
<style>
  /* Tombol disabled: warna background berbeda dan cursor not-allowed */
  #submitBtn:disabled {
    background: #a0aec0; /* Warna abu-abu */
    cursor: not-allowed;
  }
  /* Tombol aktif (enabled) akan memiliki efek hover untuk menandakan interaktivitas */
  #submitBtn:enabled:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  }
</style>

<!-- Navbar -->
<nav class="mb-4">
  <div class="px-4">
    <ul class="inline-flex space-x-3 border-b-2 border-gray-300 pb-3">
      <!-- Predict -->
      <li>
        <a
          href="{{ url_for('cvd_predict.menu', tab='predict') }}"
          data-tab="predict"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-sm {% if active_tab=='predict' %}font-semibold text-gray-800 border-b-4 border-indigo-500 bg-indigo-50{% else %}font-medium text-gray-600{% endif %}"
        >
          <!-- Icon Predict -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 116.364 6.364L12 21l-7.682-7.682a4.5 4.5 0 010-6.364z"
            />
            <polyline
              points="7 12 10 12 11 10 13 14 16 14"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
            />
          </svg>
          Predict
        </a>
      </li>
      <!-- History -->
      <li>
        <a
          href="{{ url_for('cvd_predict.menu', tab='history') }}"
          data-tab="history"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-sm {% if active_tab=='history' %}font-semibold text-gray-800 border-b-4 border-indigo-500 bg-indigo-50{% else %}font-medium text-gray-600{% endif %}"
        >
          <!-- Icon History -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4l3 3"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          History
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Konten untuk masing-masing tab -->
<div class="px-5 py-1">
  <!-- Predict Content -->
  <div
    id="predict-content"
    class="tab-content {% if active_tab == 'predict' %}block{% else %}hidden{% endif %}"
  >
    <!-- Container form -->
    <div class="flex justify-center">
      <form
        id="myForm"
        method="POST"
        action="{{ url_for('cvd_predict.upload_menu') }}"
        class="relative w-full max-w-6xl bg-white shadow-2xl rounded-3xl p-10 border border-gray-200 h-auto md:h-[65vh]"
        onsubmit="return confirm('Are you sure that the entered data is correct?');"
        novalidate
      >
        {{ form.hidden_tag() }}
        <!-- Grid Layout untuk Input -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Objective Feature Section -->
          <div>
            <h2 class="text-xl font-semibold mb-6 text-gray-700 border-b pb-2">
              I. Objective Feature
            </h2>
            <div class="space-y-6">
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.age.label }}
                </label>
                {{ form.age(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.gender.label }}
                </label>
                {{ form.gender(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.height.label }}
                </label>
                {{ form.height(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.weight.label }}
                </label>
                {{ form.weight(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
            </div>
          </div>
          <!-- Examination Feature Section -->
          <div>
            <h2 class="text-xl font-semibold mb-6 text-gray-700 border-b pb-2">
              II. Examination Feature
            </h2>
            <div class="space-y-6">
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.systolic.label }}
                </label>
                {{ form.systolic(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.diastolic.label }}
                </label>
                {{ form.diastolic(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.cholesterol.label }}
                </label>
                {{ form.cholesterol(class="bg-gray-100 border border-gray-300
                p-3 rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.gluc.label }}
                </label>
                {{ form.gluc(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
            </div>
          </div>
          <!-- Subjective Feature Section -->
          <div>
            <h2 class="text-xl font-semibold mb-6 text-gray-700 border-b pb-2">
              III. Subjective Feature
            </h2>
            <div class="space-y-6">
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.smoke.label }}
                </label>
                {{ form.smoke(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.alco.label }}
                </label>
                {{ form.alco(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
              <div class="flex flex-col">
                <label class="text-base font-medium text-gray-600 mb-2">
                  {{ form.active.label }}
                </label>
                {{ form.active(class="bg-gray-100 border border-gray-300 p-3
                rounded-lg shadow-sm focus:outline-none focus:ring-2
                focus:ring-indigo-400 transition-all duration-200 w-full",
                required="required") }}
              </div>
            </div>
          </div>
        </div>
        <!-- Tombol Submit (diposisikan secara absolute di dalam form) -->
        <div class="absolute bottom-7 left-1/2 transform -translate-x-1/2">
          <button
            type="submit"
            id="submitBtn"
            disabled
            class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-semibold py-3 px-10 rounded-2xl"
          >
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- History Content -->
  <div
    id="history-content"
    class="tab-content {% if active_tab == 'history' %}block{% else %}hidden{% endif %}"
  >
    <!-- Header Info -->
    <div class="mb-6">
      <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
        <p class="text-sm text-gray-800 mb-2"><strong>History</strong></p>
        <p class="text-sm text-gray-700" style="text-align: justify">
          This tab for user shows the log data of cardiovascular predictions.
        </p>
      </div>
    </div>
    <!-- Tabel Log Data Pasien -->
    <div class="overflow-hidden rounded-xl">
      <table
        class="min-w-full bg-white border border-gray-200 shadow-md text-center"
      >
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Timestamp
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Patient ID
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Age
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Height
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Weight
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Gender
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Sys
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Dia
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Chol
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Gluc
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Smoke
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Alco
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Active
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Cardio
            </th>
            <th
              class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-300 text-sm text-center">
          {% for data in patients %}
          <tr class="odd:bg-blue-50 even:bg-white hover:bg-gray-100">
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
              >
                {{ data.submitted_at.strftime('%Y-%m-%d %H:%M') if
                data.submitted_at else '-' }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
              >
                {{ data.user_id }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ data.age }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ data.height }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
                >{{ data.weight|int }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.gender == True %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-cyan-100 text-cyan-600"
              >
                Male
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-fuchsia-100 text-fuchsia-600"
              >
                Female
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ data.systolic }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ data.diastolic }}
              </span>
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.cholesterol == 0 %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-teal-100 text-teal-600"
              >
                Normal
              </span>
              {% elif data.cholesterol == 1 %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
              >
                Above Normal
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600"
              >
                Well Above Normal
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.gluc == 0 %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-teal-100 text-teal-600"
              >
                Normal
              </span>
              {% elif data.gluc == 1 %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
              >
                Above Normal
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600"
              >
                Well Above Normal
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.smoke == True %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
              >
                Yes
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
              >
                No
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.alco == True %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
              >
                Yes
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
              >
                No
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.active == True %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
              >
                Yes
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
              >
                No
              </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 border-gray-200">
              {% if data.cardio == True %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
              >
                At Risk
              </span>
              {% else %}
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-600"
              >
                Healthy
              </span>
              {% endif %}
            </td>
            <!-- Kolom Actions -->
            <td class="px-4 py-2 border-gray-200">
              <!-- Tombol Download PDF -->
              <a
                href="{{ url_for('cvd_predict.download_patient_pdf', patient_id=data.id) }}"
                class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded shadow transition"
                title="Download PDF Patient Data"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 inline-block"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M4 4v16h16V4H4zm6 8l4-4m0 0l4 4m-4-4v10"
                  />
                </svg>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll("a.nav-item");
    const tabContents = document.querySelectorAll(".tab-content");

    navLinks.forEach((link) => {
      link.addEventListener("click", function (e) {
        const selectedTab = this.getAttribute("data-tab");
        console.log("Selected Tab:", selectedTab);

        history.pushState(null, "", "?tab=" + selectedTab);

        navLinks.forEach((item) => {
          item.classList.remove(
            "text-gray-900",
            "font-semibold",
            "border-indigo-500",
            "bg-indigo-50",
            "border-b-4"
          );
          item.classList.add("text-gray-600", "border-b-0");
        });

        this.classList.remove("text-gray-600", "border-b-0");
        this.classList.add(
          "text-gray-900",
          "font-semibold",
          "border-indigo-500",
          "bg-indigo-50",
          "border-b-4"
        );

        tabContents.forEach((content) => {
          content.classList.add("hidden");
          content.classList.remove("block");
        });

        const targetContent = document.getElementById(selectedTab + "-content");
        if (targetContent) {
          targetContent.classList.remove("hidden");
          targetContent.classList.add("block");
        } else {
          console.error("Content not found for tab:", selectedTab);
        }
      });
    });
  });

  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("myForm");
    const submitBtn = document.getElementById("submitBtn");
    const requiredElements = form.querySelectorAll(
      "input[required], select[required], textarea[required]"
    );

    function checkForm() {
      let allFilled = true;
      requiredElements.forEach(function (element) {
        if (!element.value.trim()) {
          allFilled = false;
        }
      });
      submitBtn.disabled = !allFilled;
    }

    requiredElements.forEach(function (element) {
      element.addEventListener("input", checkForm);
      element.addEventListener("change", checkForm);
    });

    checkForm();
  });

  setTimeout(function () {
    let flashMessages = document.querySelectorAll(".flash-message");
    flashMessages.forEach(function (msg) {
      msg.style.transition = "opacity 0.5s";
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 500);
    });
  }, 5000);
</script>
{% endblock %}
