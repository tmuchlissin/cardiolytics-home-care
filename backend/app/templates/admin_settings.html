{% extends "base.html" %} {% block content %}
<div class="px-5 py-1">
  <h1 class="text-2xl font-bold mb-4">Settings</h1>
</div>

<!-- Navbar -->
<nav class="mb-4">
  <div class="px-4">
    <ul class="inline-flex space-x-3 border-b-2 border-gray-300 pb-3">
      <!-- Models -->
      <li>
        <a
          href="{{ url_for('admin.settings', tab='models') }}"
          data-tab="models"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-600 hover:text-gray-900 text-sm {% if active_tab=='models' %}font-semibold border-b-4 border-indigo-500 bg-indigo-50{% else %}font-medium{% endif %}"
        >
          <!-- Icon Model -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 13V7a2 2 0 00-2-2h-4.586a2 2 0 01-1.414-.586l-2-2A2 2 0 007.586 2H5a2 2 0 00-2 2v4M4 21v-6a2 2 0 012-2h4.586a2 2 0 001.414-.586l2-2A2 2 0 0116.414 10H19a2 2 0 012 2v6"
            />
          </svg>
          Model
        </a>
      </li>
      <!-- Devices -->
      <li>
        <a
          href="{{ url_for('admin.settings', tab='devices') }}"
          data-tab="devices"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-600 hover:text-gray-900 text-sm {% if active_tab=='devices' %}font-semibold border-b-4 border-indigo-500 bg-indigo-50{% else %}font-medium{% endif %}"
        >
          <!-- Icon Devices -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17h4.5m-9 0h9a2.25 2.25 0 002.25-2.25V6A2.25 2.25 0 0016.5 3.75h-9A2.25 2.25 0 005.25 6v8.75A2.25 2.25 0 007.5 17z"
            />
          </svg>
          Devices
        </a>
      </li>
      <!-- Docs -->
      <li>
        <a
          href="{{ url_for('admin.settings', tab='docs') }}"
          data-tab="docs"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-600 hover:text-gray-900 text-sm {% if active_tab=='docs' %}font-semibold border-b-4 border-indigo-500 bg-indigo-50{% else %}font-medium{% endif %}"
        >
          <!-- Icon Docs -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 7h10M7 11h10M7 15h10M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"
            />
          </svg>
          Docs
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Konten untuk masing-masing tab -->
<div class="px-5 py-2">
  <!-- Models Content -->
  <div
    id="models-content"
    class="tab-content {% if active_tab == 'models' %}block{% else %}hidden{% endif %}"
  >
    <!-- Header Info -->
    <div class="mb-6">
      <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
        <p class="text-sm text-gray-800 mb-2"><strong>Model Setting</strong></p>
        <p class="text-sm text-gray-700" style="text-align: justify">
          This tab is for admin to update predictive models for cardiovascular
          patients.
          <br /><br />
          <strong>Instructions :</strong> Use this section to upload a new
          predictive model. If no model is currently uploaded, click the
          <strong>"+"</strong>
          button to open the upload form. Once a model is uploaded, it will
          automatically be set as active. Only one model can be active at a
          time. To replace the current model, please delete it first by clicking
          the <strong>"Delete"</strong> button in the Actions column, then
          upload a new model.
        </p>
      </div>
    </div>
    {% if not model %}
    <div class="text-center py-8">
      <p class="text-gray-600 mb-4">No model uploaded</p>
      <button
        id="openModalModelsBtn"
        class="bg-blue-500 text-white px-3 py-1 rounded-md text-xl font-semibold"
      >
        +
      </button>
    </div>
    {% else %}
    <div class="flex items-center gap-2 mb-4 justify-start">
      <h2 class="text-lg font-semibold">Uploaded Model</h2>
    </div>
    <div class="overflow-hidden rounded-xl">
      <table
        class="min-w-full bg-white border border-gray-200 shadow-md text-center"
      >
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-600 uppercase border-b border-gray-200 tracking-wider"
            >
              Name
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-600 uppercase border-b border-gray-200 tracking-wider"
            >
              Model Name
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-600 uppercase border-b border-gray-200 tracking-wider"
            >
              Uploaded At
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-600 uppercase border-b border-gray-200 tracking-wider"
            >
              Status
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-600 uppercase border-b border-gray-200 tracking-wider text-center"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-300 text-sm text-center">
          <tr class="odd:bg-blue-50 even:bg-white hover:bg-gray-100">
            <td
              class="px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900"
            >
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
              >
                {{ model.name }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-700">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ model.filename }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-700">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ model.created_at.strftime('%Y-%m-%d %H:%M') }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap">
              {% if model.is_active %}
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"
              >
                Active
              </span>
              {% else %}
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"
              >
                Inactive
              </span>
              {% endif %}
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-center">
              <form
                method="POST"
                action="{{ url_for('admin.delete_model', model_id=model.id) }}"
                onsubmit="return confirm('Are you sure you want to delete the current model?');"
              >
                <button
                  type="submit"
                  class="inline-flex items-center gap-1 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 inline-block"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"
                    />
                  </svg>
                  <span>Delete</span>
                </button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>

  <!-- Devices Content -->
  <div
    id="devices-content"
    class="tab-content {% if active_tab == 'devices' %}block{% else %}hidden{% endif %}"
  >
    <!-- Bagian judul dan deskripsi -->
    <div class="mb-6">
      <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
        <p class="text-sm text-gray-800 mb-1">
          <strong>Devices Setting</strong>
        </p>
        <p class="text-sm text-gray-700" style="text-align: justify">
          This tab is for admin to manage IoT devices used for patient
          monitoring.
          <br /><br />
          <strong>Instructions :</strong> Use this section to add, search, and
          manage devices. To add a new device, click the
          <strong>"+"</strong> button to open the registration form. Once
          registered, each device will be displayed in the table below along
          with its registration details. You can search for devices by entering
          the Device ID or Model in the search bar. To update a device's
          information, click the <strong>"Edit"</strong> button; to remove a
          device, click the <strong>"Delete"</strong> button. Please ensure that
          each device is uniquely identified by its Device ID to avoid
          conflicts.
        </p>
      </div>
    </div>

    {% if not devices or devices|length == 0 %}
    <!-- Jika BELUM ada device -->
    <div class="flex flex-col items-center justify-center py-8 space-y-4">
      <p class="text-gray-600 text-base">No device uploaded</p>
      <button
        id="openModalDevicesBtn"
        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-xl font-semibold"
      >
        +
      </button>
    </div>
    {% else %}
    <!-- Jika SUDAH ada device -->
    <!-- Header + Tombol “+” di kanan -->
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center mb-2">
        <h2 class="text-lg font-semibold">Uploaded Devices</h2>
        <button
          id="openModalDevicesBtn"
          class="ml-2 bg-blue-500 hover:bg-blue-600 text-white px-2 rounded-md text-lg font-semibold"
        >
          +
        </button>
      </div>
    </div>

    <!-- Search Bar -->
    <div>
      <input
        type="text"
        id="searchInputDevice"
        placeholder="Search..."
        value="{{ search_query }}"
        class="w-72 px-4 py-2 border border-gray-300 rounded-md focus:outline-none mb-4"
      />
    </div>

    <div class="overflow-hidden rounded-xl">
      <table
        class="min-w-full bg-white border border-gray-200 shadow-md text-center"
      >
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-700 uppercase border-b tracking-wider"
            >
              Device ID
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-700 uppercase border-b tracking-wider"
            >
              Model
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-700 uppercase border-b tracking-wider"
            >
              Registered At
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-700 uppercase border-b tracking-wider"
            >
              Updated At
            </th>
            <th
              class="px-6 py-2 text-xs font-semibold text-gray-700 uppercase border-b tracking-wider text-center"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-300 text-sm text-center">
          {% for dev in devices %}
          <tr class="odd:bg-blue-50 even:bg-white hover:bg-gray-100">
            <td
              class="px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900"
            >
              <span
                class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
              >
                {{ dev.id }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-700">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ dev.model }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-700">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ dev.registered_at.strftime('%Y-%m-%d %H:%M') }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-sm text-gray-700">
              <span
                class="inline-block px-3 py-1 text-xs font-medium rounded-full"
              >
                {{ dev.updated_at.strftime('%Y-%m-%d %H:%M') }}
              </span>
            </td>
            <td class="px-6 py-2 whitespace-nowrap text-center">
              <!-- Tombol Edit Device -->
              <button
                type="button"
                class="inline-flex items-center gap-1 text-sm bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-md"
                data-device-id="{{ dev.id }}"
                data-device-model="{{ dev.model }}"
                onclick="openEditModalDevices(this)"
              >
                <!-- Icon Pencil -->
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 inline-block"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 
                           2.5 0 113.536 3.536L7 21H3v-4L16.732 3.732z"
                  />
                </svg>
                <span>Edit</span>
              </button>

              <!-- Tombol Delete Device -->
              <form
                method="POST"
                action="{{ url_for('admin.delete_device', device_id=dev.id) }}"
                onsubmit="return confirm('Are you sure you want to delete the current device?');"
                class="inline-block ml-2"
              >
                <button
                  type="submit"
                  class="inline-flex items-center gap-1 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md"
                >
                  <!-- Icon Trash -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 inline-block"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 
                             2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 
                             0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"
                    />
                  </svg>
                  <span>Delete</span>
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination Navigation -->
    <div class="flex justify-center mt-4">
      <nav class="inline-flex">
        {% if device_pagination.has_prev %}
        <a
          href="{{ url_for('admin.settings', tab='devices', page=device_pagination.prev_num) }}"
          class="px-3 py-2 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50 transition duration-150"
        >
          Prev
        </a>
        {% else %}
        <span
          class="px-3 py-2 text-xs font-medium text-gray-500 bg-gray-100 border border-gray-300 rounded-l-md"
        >
          Prev
        </span>
        {% endif %} {% for p in device_pagination.iter_pages(left_edge=1,
        right_edge=1, left_current=2, right_current=2) %} {% if p %} {% if p ==
        device_pagination.page %}
        <span
          class="px-3 py-2 text-xs font-medium text-white bg-blue-600 border border-blue-600"
        >
          {{ p }}
        </span>
        {% else %}
        <a
          href="{{ url_for('admin.settings', tab='devices', page=p) }}"
          class="px-3 py-2 text-xs font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 transition duration-150"
        >
          {{ p }}
        </a>
        {% endif %} {% else %}
        <span
          class="px-3 py-2 text-xs font-medium text-gray-700 bg-white border border-gray-300"
        >
          …
        </span>
        {% endif %} {% endfor %} {% if device_pagination.has_next %}
        <a
          href="{{ url_for('admin.settings', tab='devices', page=device_pagination.next_num) }}"
          class="px-4 py-2 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50 transition duration-150"
        >
          Next
        </a>
        {% else %}
        <span
          class="px-4 py-2 text-xs font-medium text-gray-500 bg-gray-100 border border-gray-300 rounded-r-md"
        >
          Next
        </span>
        {% endif %}
      </nav>
    </div>
    {% endif %}
  </div>

  <!-- Docs Content -->
  <div
    id="docs-content"
    class="tab-content {% if active_tab == 'docs' %}block{% else %}hidden{% endif %}"
  >
    <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
      <p class="text-sm text-gray-800 mb-2">
        <strong>Documents Setting</strong>
      </p>
      <p class="text-sm text-gray-700">
        This tab is for admin to manage source documents for patients to access
        information using cardiobot.
      </p>
    </div>
  </div>
</div>

<!-- Modal untuk menambahkan model baru -->
<div
  id="uploadModalModels"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
>
  <div class="bg-white rounded-lg p-6 w-96">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-semibold">Upload New Model</h3>
      <button
        id="closeModalModelsBtn"
        class="text-gray-500 hover:text-gray-700 text-2xl"
      >
        &times;
      </button>
    </div>
    <form
      method="POST"
      action="{{ url_for('admin.upload_model') }}"
      enctype="multipart/form-data"
    >
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium text-gray-700"
          >Model Name</label
        >
        {{ form.name(class="mt-1 block w-full border border-gray-300 rounded-md
        p-2") }}
      </div>
      <div class="mb-4">
        <label for="filename" class="block text-sm font-medium text-gray-700"
          >Choose model file (.pkl)</label
        >
        {{ form.filename(class="mt-1 block w-full border border-gray-300
        rounded-md p-2") }}
      </div>
      <button
        type="submit"
        class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md"
      >
        Upload
      </button>
    </form>
  </div>
</div>

<!-- Modal untuk Upload Device -->
<div
  id="uploadDevicesModal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
>
  <div class="flex items-center justify-center min-h-screen">
    <div
      class="bg-white p-6 rounded-lg shadow-lg relative w-[350px] min-h-[300px]"
    >
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Upload Device</h2>
        <button
          id="closeModalDevicesBtn"
          class="text-gray-600 hover:text-gray-800 text-2xl"
        >
          &times;
        </button>
      </div>
      <!-- Form Upload Device -->
      <form id="uploadDeviceForm" action="/admin/upload_device" method="POST">
        <div class="mb-4">
          <label for="device_id" class="block text-sm font-medium text-gray-700"
            >Device ID</label
          >
          <input
            type="text"
            name="device_id"
            id="device_id"
            class="mt-1 block w-full border border-gray-300 rounded-md p-2"
            required
          />
        </div>
        <div class="mb-4">
          <label for="model" class="block text-sm font-medium text-gray-700"
            >Model</label
          >
          <input
            type="text"
            name="model"
            id="model"
            class="mt-1 block w-full border border-gray-300 rounded-md p-2"
            required
          />
        </div>
        <div class="text-right">
          <button
            type="submit"
            class="bg-blue-500 text-white px-3 py-1 rounded-md"
          >
            Upload
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Edit Device (disembunyikan dengan 'hidden') -->
<div
  id="editDeviceModal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
>
  <div
    class="bg-white p-6 rounded-lg shadow-lg relative w-[350px] min-h-[300px]"
  >
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Edit Device</h2>
      <button
        id="closeEditModalDevicesBtn"
        type="button"
        class="text-gray-600 hover:text-gray-800 text-2xl"
      >
        &times;
      </button>
    </div>

    <!-- Form Edit Device -->
    <form
      id="editDeviceForm"
      action="{{ url_for('admin.edit_device') }}"
      method="POST"
    >
      <!-- Hidden input untuk menyimpan ID device asli -->
      <input type="hidden" name="device_id" id="edit_device_id_hidden" />

      <!-- Device ID -->
      <div class="mb-4">
        <label
          for="edit_device_id_input"
          class="block text-sm font-medium text-gray-700"
        >
          Device ID
        </label>
        <input
          type="text"
          id="edit_device_id_input"
          name="edit_device_id"
          class="mt-1 block w-full border border-gray-300 rounded-md p-2"
          required
        />
      </div>

      <!-- Model -->
      <div class="mb-4">
        <label
          for="edit_model_input"
          class="block text-sm font-medium text-gray-700"
        >
          Model
        </label>
        <input
          type="text"
          id="edit_model_input"
          name="edit_model"
          class="mt-1 block w-full border border-gray-300 rounded-md p-2"
          required
        />
      </div>

      <!-- Tombol Submit -->
      <div class="text-right">
        <button
          type="submit"
          class="bg-blue-500 text-white px-3 py-1 rounded-md"
        >
          Save
        </button>
      </div>
    </form>
  </div>
</div>

<!-- JavaScript -->
<script>
  //-------------Navbar Tab Navigation--------------------
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll("a.nav-item");
    const tabContents = document.querySelectorAll(".tab-content");

    navLinks.forEach((link) => {
      link.addEventListener("click", function (e) {
        e.preventDefault();
        const selectedTab = this.getAttribute("data-tab");
        console.log("Selected Tab:", selectedTab);

        history.pushState(null, "", "?tab=" + selectedTab);

        navLinks.forEach((item) => {
          item.classList.remove(
            "text-gray-900",
            "font-semibold",
            "border-indigo-500",
            "bg-indigo-50",
            "border-b-4"
          );
          item.classList.add("text-gray-600", "border-b-0");
        });

        this.classList.remove("text-gray-600", "border-b-0");
        this.classList.add(
          "text-gray-900",
          "font-semibold",
          "border-indigo-500",
          "bg-indigo-50",
          "border-b-4"
        );

        tabContents.forEach((content) => {
          content.classList.add("hidden");
          content.classList.remove("block");
        });

        const targetContent = document.getElementById(selectedTab + "-content");
        if (targetContent) {
          targetContent.classList.remove("hidden");
          targetContent.classList.add("block");
        } else {
          console.error("Content not found for tab:", selectedTab);
        }
      });
    });
  });

  //-------------Modal Navbar Model--------------------
  const openModalModelsBtn =
    document.getElementById("openModalModelsBtn") ||
    document.getElementById("openModalModelBtn");
  if (openModalModelsBtn) {
    openModalModelsBtn.addEventListener("click", () => {
      const modal = document.getElementById("uploadModalModels");
      if (modal) modal.classList.remove("hidden");
    });
  }
  const closeModalModelsBtn = document.getElementById("closeModalModelsBtn");
  if (closeModalModelsBtn) {
    closeModalModelsBtn.addEventListener("click", () => {
      const modal = document.getElementById("uploadModalModels");
      if (modal) modal.classList.add("hidden");
    });
  }
  window.addEventListener("click", (e) => {
    const modal = document.getElementById("uploadModalModels");
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });

  //-------------Modal Navbar Device--------------------
  //--- UPLOAD DEVICE---
  const openModalDevicesBtn = document.getElementById("openModalDevicesBtn");
  if (openModalDevicesBtn) {
    openModalDevicesBtn.addEventListener("click", () => {
      const modal = document.getElementById("uploadDevicesModal");
      if (modal) modal.classList.remove("hidden");
    });
  }
  const closeModalDevicesBtn = document.getElementById("closeModalDevicesBtn");
  if (closeModalDevicesBtn) {
    closeModalDevicesBtn.addEventListener("click", () => {
      const modal = document.getElementById("uploadDevicesModal");
      if (modal) modal.classList.add("hidden");
    });
  }
  window.addEventListener("click", (e) => {
    const modal = document.getElementById("uploadDevicesModal");
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });

  //--- EDIT DEVICE ---
  function openEditModalDevices(button) {
    const deviceId = button.getAttribute("data-device-id");
    const deviceModel = button.getAttribute("data-device-model");
    document.getElementById("edit_device_id_hidden").value = deviceId;
    document.getElementById("edit_device_id_input").value = deviceId;
    document.getElementById("edit_model_input").value = deviceModel;
    document.getElementById("editDeviceModal").classList.remove("hidden");
  }
  const closeEditDevicesModalBtn = document.getElementById(
    "closeEditModalDevicesBtn"
  );
  closeEditModalDevicesBtn.addEventListener("click", function () {
    document.getElementById("editDeviceModal").classList.add("hidden");
  });
  window.addEventListener("click", function (e) {
    const modal = document.getElementById("editDeviceModal");
    if (e.target === modal) {
      modal.classList.add("hidden");
    }
  });

  //--- SEARCH DEVICE ---
  let searchTimeout;
  document
    .getElementById("searchInputDevice")
    .addEventListener("keyup", function () {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        const searchValue = this.value.trim();
        const url = new URL(window.location.href);

        if (searchValue) {
          url.searchParams.set("search", searchValue);
        } else {
          url.searchParams.delete("search");
        }

        // Reset halaman ke 1 setiap kali pencarian baru
        url.searchParams.set("page", 1);
        window.location.href = url.href;
      }, 500);
    });

  //-------------Flash Message--------------------
  setTimeout(function () {
    let flashMessages = document.querySelectorAll(".flash-message");
    flashMessages.forEach(function (msg) {
      msg.style.transition = "opacity 0.5s";
      msg.style.opacity = "0";
      setTimeout(() => msg.remove(), 500);
    });
  }, 2000);
</script>
{% endblock %}
