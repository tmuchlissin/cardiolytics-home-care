{% extends "base.html" %} {% block content %}
<div class="px-5 py-1">
  <h1 class="text-xl font-bold mb-4">Settings</h1>
</div>

<!-- Navbar -->
<nav class="mb-4">
  <div class="px-4">
    <ul class="inline-flex space-x-3 border-b-2 border-gray-300 pb-3">
      <!-- Models -->
      <li>
        <a
          href="#"
          data-tab="models"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-900 text-sm font-semibold border-b-4 border-indigo-500 bg-indigo-50"
        >
          <!-- Icon Model -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 13V7a2 2 0 00-2-2h-4.586a2 2 0 01-1.414-.586l-2-2A2 2 0 007.586 2H5a2 2 0 00-2 2v4M4 21v-6a2 2 0 012-2h4.586a2 2 0 001.414-.586l2-2A2 2 0 0116.414 10H19a2 2 0 012 2v6"
            />
          </svg>
          Models
        </a>
      </li>
      <!-- Devices -->
      <li>
        <a
          href="#"
          data-tab="devices"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-600 hover:text-gray-900 text-sm font-semibold"
        >
          <!-- Icon Devices -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.75 17h4.5m-9 0h9a2.25 2.25 0 002.25-2.25V6A2.25 2.25 0 0016.5 3.75h-9A2.25 2.25 0 005.25 6v8.75A2.25 2.25 0 007.5 17z"
            />
          </svg>
          Devices
        </a>
      </li>
      <!-- Docs -->
      <li>
        <a
          href="#"
          data-tab="docs"
          class="nav-item inline-flex items-center px-3 py-1.5 bg-white border border-gray-300 rounded-md shadow-sm transition-colors duration-200 ease-in-out text-gray-600 hover:text-gray-900 text-sm font-semibold"
        >
          <!-- Icon Docs -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4 mr-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 7h10M7 11h10M7 15h10M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"
            />
          </svg>
          Docs
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Konten untuk masing-masing tab -->
<div class="px-5 py-2">
  <!-- Models Content -->
  <div id="models-content" class="tab-content">
    <!-- Header Info -->
    <div class="mb-6">
      <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
        <p class="text-sm text-gray-800 mb-2">
          <strong>Models Setting</strong>
        </p>
        <p class="text-sm text-gray-700">
          This tab is for admin to update predictive models for cardiovascular
          patients.
          <br /><br />
          <strong>Instructions :</strong> Use this section to upload a new
          predictive model. If no model is currently uploaded, click the "+"
          button to open the upload form. Once a model is uploaded, it will
          automatically be set as active. Only one model can be active at a
          time. To replace the current model, please delete it first by clicking
          the "Delete" button in the Actions column, then upload a new model.
        </p>
      </div>
    </div>
    {% if not model %}
    <!-- Jika tidak ada model, tampilkan pesan dan tombol upload aktif -->
    <div class="text-center py-8">
      <p class="text-gray-600 mb-4">No model uploaded</p>
      <button
        id="openModalModelsBtn"
        class="bg-blue-500 text-white px-3 py-1 rounded-md text-xl font-semibold"
      >
        +
      </button>
    </div>
    {% else %}
    <!-- Jika sudah ada model, tampilkan informasi model tanpa tombol "+" -->
    <div class="flex items-center gap-2 mb-4 justify-start">
      <h2 class="text-lg font-semibold">Uploaded Model</h2>
    </div>
    <!-- Tabel atau Card untuk menampilkan model yang terupload -->
    <div class="overflow-hidden rounded-xl">
      <table
        class="min-w-full bg-white border border-gray-200 shadow-md text-center"
      >
        <thead class="bg-gray-100">
          <tr>
            <th
              class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Name
            </th>
            <th
              class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Model Name
            </th>
            <th
              class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Created At
            </th>
            <th
              class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider"
            >
              Status
            </th>
            <th
              class="px-6 py-3 text-xs font-semibold text-gray-700 uppercase tracking-wider text-center"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr class="odd:bg-gray-50 even:bg-white hover:bg-gray-100">
            <td
              class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
            >
              {{ model.name }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
              {{ model.filename }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
              {{ model.created_at.strftime('%Y-%m-%d %H:%M') }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              {% if model.is_active %}
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"
              >
                Active
              </span>
              {% else %}
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800"
              >
                Inactive
              </span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-center">
              <!-- Tombol Delete Model -->
              <form
                method="POST"
                action="{{ url_for('admin.delete_model', model_id=model.id) }}"
                onsubmit="return confirm('Are you sure you want to delete the current model?');"
              >
                <button
                  type="submit"
                  class="inline-flex items-center gap-1 text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-md"
                >
                  <!-- Heroicons Trash Icon -->
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 inline-block"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5
                      4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3m5 0H6"
                    />
                  </svg>
                  <span>Delete</span>
                </button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
  <!-- Devices Content -->
  <div id="devices-content" class="tab-content hidden">
    <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
      <p class="text-sm text-gray-800 mb-2"><strong>Devices Setting</strong></p>
      <p class="text-sm text-gray-700">
        This tab is for admin to manage devices for every patients.
      </p>
    </div>
  </div>
  <!-- Docs Content -->
  <div id="docs-content" class="tab-content hidden">
    <div class="border border-gray-300 p-4 rounded-lg bg-gray-100 w-fit">
      <p class="text-sm text-gray-800 mb-2">
        <strong>Documents Setting</strong>
      </p>
      <p class="text-sm text-gray-700">
        This tab is for admin to manage source documents for patients to access
        information using cardiobot.
      </p>
    </div>
  </div>
</div>

<!-- Modal untuk menambahkan model baru -->
<div
  id="uploadModelModal"
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden"
>
  <div class="bg-white rounded-lg p-6 w-96">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-semibold">Upload New Model</h3>
      <button
        id="closeModalBtn"
        class="text-gray-500 hover:text-gray-700 text-2xl"
      >
        &times;
      </button>
    </div>
    <form
      method="POST"
      action="{{ url_for('admin.upload_model') }}"
      enctype="multipart/form-data"
    >
      <div class="mb-4">
        <label for="name" class="block text-sm font-medium text-gray-700"
          >Model Name</label
        >
        {{ form.name(class="mt-1 block w-full border border-gray-300 rounded-md
        p-2") }}
      </div>
      <div class="mb-4">
        <label for="filename" class="block text-sm font-medium text-gray-700"
          >Choose model file (.pkl)</label
        >
        {{ form.filename(class="mt-1 block w-full border border-gray-300
        rounded-md p-2") }}
      </div>
      <button
        type="submit"
        class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md"
      >
        Upload Model
      </button>
    </form>
  </div>
</div>

<!-- Flash Messages -->
<div class="fixed top-[70px] left-1/2 transform -translate-x-1/2 z-50">
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <div class="mt-4">
    <ul class="space-y-2">
      {% for category, message in messages %}
      <li
        class="flash-message mb-3 p-3 rounded-md shadow-md {% if category == 'success' %} bg-green-100 border border-green-400 text-green-700 {% elif category == 'warning' %} bg-yellow-100 border border-yellow-400 text-yellow-700 {% elif category == 'danger' %} bg-red-100 border border-red-400 text-red-700 {% endif %}"
      >
        {{ message }}
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endif %} {% endwith %}

  <!-- Script untuk mengatur klik navbar dan tampilan konten -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const navLinks = document.querySelectorAll("a.nav-item");
      const tabContents = document.querySelectorAll(".tab-content");

      navLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          const selectedTab = this.getAttribute("data-tab");
          console.log("Selected Tab:", selectedTab);
          // Hapus styling aktif dari semua nav link
          navLinks.forEach((item) => {
            item.classList.remove(
              "text-gray-900",
              "font-semibold",
              "border-indigo-500",
              "bg-indigo-50",
              "border-b-4"
            );
            item.classList.add("text-gray-600", "border-b-0");
          });
          // Tambahkan styling aktif ke link yang diklik
          this.classList.remove("text-gray-600", "border-b-0");
          this.classList.add(
            "text-gray-900",
            "font-semibold",
            "border-indigo-500",
            "bg-indigo-50",
            "border-b-4"
          );

          // Sembunyikan semua konten tab
          tabContents.forEach((content) => {
            content.classList.add("hidden");
            content.classList.remove("block");
          });
          // Tampilkan konten tab yang sesuai
          const targetContent = document.getElementById(
            selectedTab + "-content"
          );
          if (targetContent) {
            targetContent.classList.remove("hidden");
            targetContent.classList.add("block");
          } else {
            console.error("Content not found for tab:", selectedTab);
          }
        });
      });
    });

    // Gunakan id unik untuk tombol modal di Models
    const openModalBtn =
      document.getElementById("openModalModelsBtn") ||
      document.getElementById("openModalBtn");
    if (openModalBtn) {
      openModalBtn.addEventListener("click", () => {
        const modal = document.getElementById("uploadModelModal");
        if (modal) modal.classList.remove("hidden");
      });
    }
    const closeModalBtn = document.getElementById("closeModalBtn");
    if (closeModalBtn) {
      closeModalBtn.addEventListener("click", () => {
        const modal = document.getElementById("uploadModelModal");
        if (modal) modal.classList.add("hidden");
      });
    }
    // Tutup modal jika klik di luar
    window.addEventListener("click", (e) => {
      const modal = document.getElementById("uploadModelModal");
      if (e.target === modal) {
        modal.classList.add("hidden");
      }
    });

    setTimeout(function () {
      let flashMessages = document.querySelectorAll(".flash-message");
      flashMessages.forEach(function (msg) {
        msg.style.transition = "opacity 0.5s";
        msg.style.opacity = "0";
        setTimeout(() => msg.remove(), 500);
      });
    }, 2000);
  </script>
  {% endblock %}
</div>
