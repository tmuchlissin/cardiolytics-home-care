<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to External CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      rel="icon"
      type="image/png"
      href="{{ url_for('static', filename='img/medical-check.png') }}"
    />
    <style>
      /* Import font Poppins */
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap");

      body {
        font-family: "Poppins", sans-serif;
      }
      #register-btn:disabled:hover #tooltip {
        display: block;
      }
    </style>
  </head>
  <body
    class="bg-gray-200 flex flex-col items-center justify-center min-h-screen"
  >
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <div
      class="absolute top-4 sm:top-5 w-full max-w-xs sm:max-w-lg px-4 sm:px-6"
    >
      {% for category, message in messages %}
      <div
        class="flash-message p-2 sm:p-3 rounded-lg text-center font-semibold {% if category == 'success' %} bg-green-100 border border-green-400 text-green-700 {% elif category == 'warning' %} bg-yellow-100 border border-yellow-400 text-yellow-700 {% elif category == 'danger' %} bg-red-100 border border-red-400 text-red-700 {% elif category == 'attention' %} bg-gray-100 border border-gray-400 text-gray-700 {% endif %} text-xs sm:text-sm"
      >
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %} {% endwith %}

    <div
      class="bg-white shadow-lg rounded-lg w-full max-w-xs sm:max-w-sm md:max-w-lg mx-4 sm:mx-6 p-4 sm:p-6 lg:p-8"
    >
      <!-- Logo (Clickable) -->
      <a href="{{ url_for('auth.landing_page') }}">
        <img
          src="{{ url_for('static', filename='img/cardiolytics.png') }}"
          class="w-28 sm:w-36 md:w-48 h-auto mb-4 mx-auto"
          draggable="false"
          oncontextmenu="return false;"
          ondragstart="return false;"
          onmousedown="return false;"
          alt="Cardiolytics Logo"
        />
      </a>
      <h2 class="text-xl sm:text-2xl font-bold text-teal-600 text-center">
        Create Account
      </h2>
      <p class="text-gray-600 mt-2 mb-3 text-center text-xs sm:text-sm">
        Fill in the details to create your account.
      </p>

      <form method="POST" action="{{ url_for('auth.register') }}">
        {{ form.hidden_tag() }}
        <!-- CSRF Protection -->

        <!-- Patient ID -->
        <div class="mb-2 sm:mb-3">
          <label
            for="patient_id"
            class="block text-gray-700 text-sm sm:text-base"
            >Patient ID</label
          >
          <input
            type="text"
            name="patient_id"
            id="patient_id"
            placeholder="Enter your 10-digit Patient ID"
            pattern="^\d{10}$"
            maxlength="10"
            title="Patient ID must be 10 digits"
            required
            class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 text-sm sm:text-base"
          />
        </div>

        <!-- Full Name -->
        <div class="mb-2 sm:mb-3">
          <label for="fullname" class="block text-gray-700 text-sm sm:text-base"
            >Full Name</label
          >
          <input
            type="text"
            name="full_name"
            id="full_name"
            placeholder="Enter your full name"
            required
            class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 text-sm sm:text-base"
          />
        </div>

        <!-- Nickname -->
        <div class="mb-2 sm:mb-3">
          <label for="nickname" class="block text-gray-700 text-sm sm:text-base"
            >Nickname</label
          >
          <input
            type="text"
            name="nickname"
            id="nickname"
            placeholder="Enter your nickname"
            required
            class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 text-sm sm:text-base"
          />
        </div>

        <!-- Email -->
        <div class="mb-2 sm:mb-3">
          <label for="email" class="block text-gray-700 text-sm sm:text-base"
            >Email</label
          >
          <input
            type="email"
            name="email"
            id="email"
            placeholder="example@domain.com"
            required
            class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 text-sm sm:text-base"
          />
        </div>

        <!-- Phone Number -->
        <div class="mb-2 sm:mb-3">
          <label
            for="phone_number"
            class="block text-gray-700 text-sm sm:text-base"
            >Phone Number</label
          >
          <input
            type="text"
            name="phone_number"
            id="phone_number"
            placeholder="Enter your phone number"
            pattern="^\d{10,13}$"
            maxlength="13"
            title="Phone number must be 10-13 digits"
            required
            class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 text-sm sm:text-base"
          />
        </div>

        <!-- Password Label with Info Icon -->
        <label
          for="password"
          class="block text-gray-700 flex items-center text-sm sm:text-base"
        >
          Password
          <span class="ml-2 relative group">
            <i
              class="fa-solid fa-circle-info text-gray-500 cursor-pointer text-sm"
            ></i>
            <span
              class="absolute left-0 bottom-5 hidden group-hover:block sm:group-hover:block bg-black text-white text-xs px-2 sm:px-4 py-1 sm:py-2 rounded-lg w-48 sm:w-60 shadow-lg z-10"
            >
              ✅ Minimum 8 characters<br />
              ✅ At least one uppercase letter (A-Z)<br />
              ✅ At least one lowercase letter (a-z)<br />
              ✅ At least one number (0-9)<br />
              ✅ At least one special character (@$!%*?&)
            </span>
          </span>
        </label>

        <!-- Password Input with Strength Indicator -->
        <div class="mb-2 sm:mb-3 relative">
          <div class="relative">
            <input
              type="password"
              name="password"
              id="password"
              placeholder="Enter your password"
              required
              class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 pr-10 text-sm sm:text-base"
              onkeyup="checkPasswordStrength()"
            />
            <button
              type="button"
              id="togglePassword"
              class="absolute inset-y-0 right-3 flex items-center"
            >
              <i
                id="eyeIconPassword"
                class="fa-solid fa-eye text-gray-500 text-sm"
              ></i>
            </button>
          </div>
          <p id="password-strength" class="mt-1 text-xs sm:text-sm"></p>
        </div>

        <!-- Confirm Password -->
        <div class="mb-4 sm:mb-6 relative">
          <label
            for="confirm_password"
            class="block text-gray-700 text-sm sm:text-base"
            >Confirm Password</label
          >
          <div class="relative">
            <input
              type="password"
              name="confirm_password"
              id="confirm_password"
              placeholder="Retype your password"
              required
              class="w-full px-3 sm:px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-300 pr-10 text-sm sm:text-base"
              onkeyup="checkPasswordMatch()"
            />
            <button
              type="button"
              id="toggleConfirmPassword"
              class="absolute inset-y-0 right-3 flex items-center"
            >
              <i
                id="eyeIconConfirmPassword"
                class="fa-solid fa-eye text-gray-500 text-sm"
              ></i>
            </button>
          </div>
          <p id="confirm-password-message" class="mt-1 text-xs sm:text-sm"></p>
        </div>

        <!-- Register Button (Disabled Initially) -->
        <button
          type="submit"
          id="register-btn"
          class="w-full bg-teal-400 text-white py-2 rounded-lg transition opacity-50 cursor-not-allowed relative text-sm sm:text-base"
          disabled
        >
          Sign up
        </button>
      </form>

      <p class="mt-3 text-center text-gray-500 text-xs sm:text-sm">
        Already have an account?
        <a
          href="{{ url_for('auth.login') }}"
          class="text-blue-500 hover:underline"
          >Sign in</a
        >
      </p>
    </div>

    <!-- JavaScript for Password Toggle and Validation -->
    <script>
      let isPasswordStrong = false;
      let doPasswordsMatch = false;

      function checkPasswordStrength() {
        const password = document.getElementById("password").value;
        const strengthBar = document.getElementById("password-strength");
        const strongPassword = new RegExp(
          "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&]).{8,}$"
        );

        if (password.length < 8) {
          strengthBar.innerHTML = "❌ Too short (minimum 8 characters)";
          strengthBar.className = "text-red-500 text-xs sm:text-sm";
          isPasswordStrong = false;
        } else if (!strongPassword.test(password)) {
          strengthBar.innerHTML =
            "⚠ Weak password (must include uppercase, lowercase, number, and special character)";
          strengthBar.className = "text-yellow-500 text-xs sm:text-sm";
          isPasswordStrong = false;
        } else {
          strengthBar.innerHTML = "✅ Strong password!";
          strengthBar.className = "text-green-500 text-xs sm:text-sm";
          isPasswordStrong = true;
        }

        checkFormCompletion();
      }

      function checkPasswordMatch() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirm_password").value;
        const message = document.getElementById("confirm-password-message");

        if (confirmPassword === "") {
          message.innerHTML = "";
          doPasswordsMatch = false;
        } else if (password !== confirmPassword) {
          message.innerHTML = "❌ Passwords do not match!";
          message.className = "text-red-500 text-xs sm:text-sm";
          doPasswordsMatch = false;
        } else {
          message.innerHTML = "✅ Passwords match!";
          message.className = "text-green-500 text-xs sm:text-sm";
          doPasswordsMatch = true;
        }

        checkFormCompletion();
      }

      function checkFormCompletion() {
        const formInputs = document.querySelectorAll("form input[required]");
        const registerBtn = document.getElementById("register-btn");

        let allFilled = true;
        formInputs.forEach((input) => {
          if (!input.value.trim()) {
            allFilled = false;
          }
        });

        if (allFilled && isPasswordStrong && doPasswordsMatch) {
          registerBtn.disabled = false;
          registerBtn.classList.remove("opacity-50", "cursor-not-allowed");
        } else {
          registerBtn.disabled = true;
          registerBtn.classList.add("opacity-50", "cursor-not-allowed");
        }
      }

      function togglePasswordVisibility(passwordId, eyeIconId) {
        const passwordInput = document.getElementById(passwordId);
        const eyeIcon = document.getElementById(eyeIconId);

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          eyeIcon.classList.remove("fa-eye");
          eyeIcon.classList.add("fa-eye-slash");
        } else {
          passwordInput.type = "password";
          eyeIcon.classList.remove("fa-eye-slash");
          eyeIcon.classList.add("fa-eye");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const registerBtn = document.getElementById("register-btn");
        const formInputs = document.querySelectorAll("form input[required]");

        formInputs.forEach((input) => {
          input.addEventListener("input", checkFormCompletion);
        });

        document
          .getElementById("password")
          .addEventListener("input", checkPasswordStrength);

        document
          .getElementById("confirm_password")
          .addEventListener("input", checkPasswordMatch);

        document
          .getElementById("togglePassword")
          .addEventListener("click", function () {
            togglePasswordVisibility("password", "eyeIconPassword");
          });

        document
          .getElementById("toggleConfirmPassword")
          .addEventListener("click", function () {
            togglePasswordVisibility(
              "confirm_password",
              "eyeIconConfirmPassword"
            );
          });

        checkFormCompletion();

        setTimeout(function () {
          let flashMessages = document.querySelectorAll(".flash-message");
          flashMessages.forEach(function (msg) {
            msg.style.transition = "opacity 0.5s";
            msg.style.opacity = "0";
            setTimeout(() => msg.remove(), 500);
          });
        }, 2000);
      });
    </script>
  </body>
</html>
