{% extends "base.html" %} {% block content %}
<div class="px-5 py-1">
  <h1 class="text-2xl font-bold mb-4">Patient Data</h1>

  <!-- Search Bar (kiri) -->
  <div class="mb-4">
    <input
      type="text"
      id="searchInput"
      name="search"
      placeholder="Search by Patient ID..."
      value="{{ request.args.get('search', '') }}"
      class="w-72 px-4 py-2 border border-gray-300 rounded-md font-medium focus:outline-none"
    />
  </div>

  <!-- Tabel Log Data Pasien -->
  <div class="overflow-hidden rounded-xl">
    <table
      class="min-w-full bg-white border border-gray-200 shadow-md text-center"
    >
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Timestamp
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Patient ID
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Age
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Height
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Weight
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Gender
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Sys
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Dia
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Chol
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Gluc
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Smoke
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Alco
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Active
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Cardio
          </th>
          <th
            class="px-4 py-2 text-xs font-bold text-gray-600 uppercase border-b border-gray-200"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-300 text-sm text-center">
        {% for data in patient_data %}
        <tr class="odd:bg-blue-50 even:bg-white hover:bg-gray-100">
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
            >
              {{ data.submitted_at.strftime('%Y-%m-%d %H:%M') if
              data.submitted_at else '-' }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full"
            >
              {{ data.user_id }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-medium rounded-full"
            >
              {{ data.age }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-medium rounded-full"
            >
              {{ data.height }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-medium rounded-full"
            >
              {{ data.weight|int }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.gender == True %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-cyan-100 text-cyan-600"
            >
              Male
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-fuchsia-100 text-fuchsia-600"
            >
              Female
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-medium rounded-full"
            >
              {{ data.systolic }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            <span
              class="inline-block px-3 py-1 text-xs font-medium rounded-full"
            >
              {{ data.diastolic }}
            </span>
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.cholesterol == 0 %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-teal-100 text-teal-600"
            >
              Normal
            </span>
            {% elif data.cholesterol == 1 %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
            >
              Above Normal
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600"
            >
              Well Above Normal
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.gluc == 0 %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-teal-100 text-teal-600"
            >
              Normal
            </span>
            {% elif data.gluc == 1 %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
            >
              Above Normal
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-600"
            >
              Well Above Normal
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.smoke == True %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
            >
              Yes
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
            >
              No
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.alco == True %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
            >
              Yes
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
            >
              No
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.active == True %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-lime-100 text-lime-600"
            >
              Yes
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-violet-100 text-violet-600"
            >
              No
            </span>
            {% endif %}
          </td>
          <td class="px-4 py-2 border-gray-200">
            {% if data.cardio == True %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-600"
            >
              At Risk
            </span>
            {% else %}
            <span
              class="inline-block px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-600"
            >
              Healthy
            </span>
            {% endif %}
          </td>
          <!-- Kolom Actions -->

          <td class="px-4 py-2 border-gray-200">
              <!-- Tombol Download PDF -->
              <a
                href="{{ url_for('admin.download_patient_data', patient_id=data.id) }}"
                class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded shadow transition"
                title="Download PDF Patient Data"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-4 w-4 inline-block"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M4 4v16h16V4H4zm6 8l4-4m0 0l4 4m-4-4v10"
                  />
                </svg>
              </a>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <div class="flex justify-center mt-4">
    <nav class="inline-flex">
      {% if pagination.has_prev %}
      <a
        href="{{ url_for('admin.patient_data', page=pagination.prev_num, per_page=entries_per_page, search=search_query) }}"
        class="px-3 py-1 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50 transition duration-150"
      >
        Prev
      </a>
      {% else %}
      <span
        class="px-3 py-1 text-xs font-medium text-gray-500 bg-gray-100 border border-gray-300 rounded-l-md"
      >
        Prev
      </span>
      {% endif %} {% for page_num in pagination.iter_pages(left_edge=1,
      right_edge=1, left_current=2, right_current=2) %} {% if page_num %} {% if
      page_num == pagination.page %}
      <span
        class="px-3 py-1 text-xs font-medium text-white bg-blue-600 border border-blue-600"
      >
        {{ page_num }}
      </span>
      {% else %}
      <a
        href="{{ url_for('admin.patient_data', page=page_num, per_page=entries_per_page, search=search_query) }}"
        class="px-3 py-1 text-xs font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 transition duration-150"
      >
        {{ page_num }}
      </a>
      {% endif %} {% else %}
      <span
        class="px-3 py-1 text-xs font-medium text-gray-700 bg-white border border-gray-300"
      >
        …
      </span>
      {% endif %} {% endfor %} {% if pagination.has_next %}
      <a
        href="{{ url_for('admin.patient_data', page=pagination.next_num, per_page=entries_per_page, search=search_query) }}"
        class="px-4 py-1 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50 transition duration-150"
      >
        Next
      </a>
      {% else %}
      <span
        class="px-4 py-1 text-xs font-medium text-gray-500 bg-gray-100 border border-gray-300 rounded-r-md"
      >
        Next
      </span>
      {% endif %}
    </nav>
  </div>
</div>
<script>
  let searchTimeout;
  document.getElementById("searchInput").addEventListener("keyup", function () {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      const searchValue = this.value.trim();
      const url = new URL(window.location.href);
      if (searchValue) {
        url.searchParams.set("search", searchValue);
      } else {
        url.searchParams.delete("search");
      }
      url.searchParams.set("page", 1);
      window.location.href = url.href;
    }, 500);
  });

  function changeEntriesPerPage(perPage) {
    const url = new URL(window.location.href);
    url.searchParams.set("per_page", perPage);
    url.searchParams.set("page", 1);
    window.location.href = url.href;
  }
</script>
{% endblock %}
